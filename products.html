<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Products – Wholesale eBay Products</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
      min-height: 100vh;
    }
    a {
      color: inherit;
      text-decoration: none;
    }
    .page {
      max-width: 1120px;
      margin: 0 auto;
      padding: 20px 16px 40px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 12px;
      flex-wrap: wrap;
    }
    .logo {
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #a5b4fc;
    }
    .nav-links a {
      font-size: 0.9rem;
      margin-left: 12px;
      color: #9ca3af;
    }
    .nav-links a:hover {
      color: #e5e7eb;
    }
    h1 {
      font-size: 1.6rem;
      margin-bottom: 4px;
    }
    .subtitle {
      font-size: 0.95rem;
      color: #9ca3af;
      margin-bottom: 14px;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 18px;
    }
    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #334155;
      font-size: 0.78rem;
      color: #e5e7eb;
      background: #020617;
    }
    .pill--green { border-color: #16a34a; color: #bbf7d0; }
    .pill--blue { border-color: #3b82f6; color: #bfdbfe; }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 18px;
    }
    .card {
      background: #020617;
      border-radius: 18px;
      border: 1px solid #1f2937;
      box-shadow: 0 18px 35px rgba(0,0,0,0.55);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .card-top {
      padding: 12px 12px 0;
    }
    .img-shell {
      position: relative;
      background: #0b1120;
      border-radius: 14px;
      overflow: hidden;
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }
    .img-shell img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
    }
    .img-placeholder {
      width: 90%;
      height: 70%;
      border-radius: 12px;
      background: #111827;
      border: 1px dashed #374151;
    }
    .card-title {
      font-weight: 600;
      font-size: 0.98rem;
      margin-bottom: 2px;
    }
    .card-sub {
      font-size: 0.82rem;
      color: #9ca3af;
      margin-bottom: 2px;
    }
    .card-body {
      padding: 4px 12px 10px;
      font-size: 0.82rem;
      color: #d1d5db;
    }
    .price-label {
      font-size: 0.76rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #9ca3af;
      margin-top: 3px;
    }
    .price-value {
      color: #22c55e;
      font-weight: 700;
      font-size: 0.98rem;
      margin-bottom: 6px;
    }
    .muted {
      font-size: 0.8rem;
      color: #9ca3af;
    }
    .price-row {
      margin-top: 6px;
      margin-bottom: 8px;
    }
    .card-footer {
      padding: 6px 12px 10px;
      border-top: 1px solid #111827;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      justify-content: space-between;
    }
    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .tag {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.72rem;
      border: 1px solid #374151;
      color: #e5e7eb;
    }
    .tag--feat {
      border-color: #22c55e;
      color: #bbf7d0;
    }
    .tag--type {
      border-color: #38bdf8;
      color: #bae6fd;
    }
    .card-id {
      font-size: 0.72rem;
      color: #6b7280;
    }
    .status-bar {
      margin-top: 6px;
      font-size: 0.8rem;
      color: #9ca3af;
    }
    .status-dot {
      display: inline-block;
      width: 7px;
      height: 7px;
      border-radius: 999px;
      margin-right: 4px;
      background: #22c55e;
    }
    .status-dot.off {
      background: #9ca3af;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div>
        <div class="logo">Wholesale eBay Products</div>
      </div>
      <nav class="nav-links">
        <a href="./index.html">Back to landing</a>
        <a href="./admin.html">Admin</a>
      </nav>
    </header>

    <main>
      <h1>All Wholesale Products</h1>
      <p class="subtitle">
        These are the items currently available for approved eBay sellers. Pricing and availability may change over time.
      </p>
      <div class="pill-row">
        <span class="pill pill--green">Live data from Google Sheets</span>
        <span class="pill pill--blue">US warehouse / ready to ship</span>
      </div>

      <div id="status" class="status-bar">
        <span class="status-dot off"></span> Loading products from Google Sheets…
      </div>

      <section id="productsGrid" class="products-grid" aria-live="polite"></section>
    </main>
  </div>

  <script>
    // URL for your published Products sheet (CSV output)
    const PRODUCTS_SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vST7uNhUD6X51DlQd2ZrJETR2AXUljk2K8cqm39K8SLbxoLcFOK0Md57j9xYAjglStlyqIlRkZ1kYod/pub?gid=790653222&single=true&output=csv";

    const statusEl = document.getElementById("status");
    const gridEl = document.getElementById("productsGrid");

    function setStatus(text, ok) {
      if (!statusEl) return;
      statusEl.textContent = text;
      const dot = statusEl.querySelector(".status-dot");
      if (dot) {
        dot.classList.toggle("off", !ok);
      }
    }

    function csvToObjects(csvText) {
      const lines = csvText.trim().split(/\r?\n/);
      if (!lines.length) return [];
      const headers = lines[0].split(",").map(h => h.trim());
      const rows = [];

      for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        if (!line.trim()) continue;

        // Basic split, assumes no commas inside values.
        const cols = line.split(",").map(c => c.trim());
        const obj = {};
        headers.forEach((h, idx) => {
          obj[h] = (cols[idx] || "").trim();
        });
        rows.push(obj);
      }
      return rows;
    }

    function renderProducts(products) {
      gridEl.innerHTML = "";

      if (!products.length) {
        gridEl.innerHTML = "<p>No active products found.</p>";
        setStatus("No active products are currently listed.", false);
        return;
      }

      setStatus(`Showing ${products.length} active product${products.length === 1 ? "" : "s"}.`, true);

      products.forEach(p => {
        const card = document.createElement("article");
        card.className = "card";

        const shortName = p.short_name || p.product_name || "Unnamed product";
        const category = p.category || "";
        const type = p.product_type || "";

        const resellerPrice = p.reseller_price_usd ? parseFloat(p.reseller_price_usd) : null;
        const suggMin = p.suggested_min_price_usd ? parseFloat(p.suggested_min_price_usd) : null;
        const suggMax = p.suggested_max_price_usd ? parseFloat(p.suggested_max_price_usd) : null;
        const estMin = p.est_profit_min_usd ? parseFloat(p.est_profit_min_usd) : null;
        const estMax = p.est_profit_max_usd ? parseFloat(p.est_profit_max_usd) : null;

        // Image logic – use URL exactly as stored
        const imgUrlRaw = (p.image_url || "").trim();
        const hasImg = !!imgUrlRaw;

        const top = document.createElement("div");
        top.className = "card-top";

        const imgShell = document.createElement("div");
        imgShell.className = "img-shell";

        if (hasImg) {
          const img = document.createElement("img");
          img.src = imgUrlRaw;
          img.alt = shortName;

          // If the URL fails at runtime, fall back to placeholder
          img.onerror = () => {
            imgShell.innerHTML = "";
            const ph = document.createElement("div");
            ph.className = "img-placeholder";
            imgShell.appendChild(ph);
          };

          imgShell.appendChild(img);
        } else {
          const placeholder = document.createElement("div");
          placeholder.className = "img-placeholder";
          imgShell.appendChild(placeholder);
        }

        top.appendChild(imgShell);

        const titleEl = document.createElement("div");
        titleEl.className = "card-title";
        titleEl.textContent = shortName;
        top.appendChild(titleEl);

        const subEl = document.createElement("div");
        subEl.className = "card-sub";
        const bits = [];
        if (category) bits.push(category);
        if (type) bits.push(`Type: ${type}`);
        subEl.textContent = bits.join(" • ");
        top.appendChild(subEl);

        const body = document.createElement("div");
        body.className = "card-body";

        const priceLabel = document.createElement("div");
        priceLabel.className = "price-label";
        priceLabel.textContent = "Reseller price";
        body.appendChild(priceLabel);

        const priceVal = document.createElement("div");
        priceVal.className = "price-value";
        priceVal.textContent = resellerPrice != null ? `$${resellerPrice.toFixed(2)}` : "—";
        body.appendChild(priceVal);

        const priceRow = document.createElement("div");
        priceRow.className = "price-row";

        const line1 = document.createElement("div");
        line1.className = "muted";
        if (suggMin != null && suggMax != null) {
          line1.textContent = `Suggested eBay: $${suggMin.toFixed(2)}–$${suggMax.toFixed(2)}`;
        } else {
          line1.textContent = "Suggested eBay: —";
        }
        priceRow.appendChild(line1);

        const line2 = document.createElement("div");
        line2.className = "muted";
        if (estMin != null && estMax != null) {
          line2.textContent = `Est. profit: $${estMin.toFixed(2)}–$${estMax.toFixed(2)}`;
        } else {
          line2.textContent = "Est. profit: —";
        }
        priceRow.appendChild(line2);

        body.appendChild(priceRow);

        if (p.notes) {
          const notes = document.createElement("div");
          notes.className = "muted";
          notes.textContent = p.notes;
          body.appendChild(notes);
        }

        const footer = document.createElement("div");
        footer.className = "card-footer";

        const tagRow = document.createElement("div");
        tagRow.className = "tag-row";

        if ((p.is_featured || "").toUpperCase() === "TRUE") {
          const t = document.createElement("span");
          t.className = "tag tag--feat";
          t.textContent = "Featured";
          tagRow.appendChild(t);
        }

        if (type) {
          const t = document.createElement("span");
          t.className = "tag tag--type";
          t.textContent = type;
          tagRow.appendChild(t);
        }

        if (category) {
          const t = document.createElement("span");
          t.className = "tag";
          t.textContent = category;
          tagRow.appendChild(t);
        }

        footer.appendChild(tagRow);

        const idEl = document.createElement("div");
        idEl.className = "card-id";
        idEl.textContent = p.product_id ? `ID: ${p.product_id}` : "";
        footer.appendChild(idEl);

        card.appendChild(top);
        card.appendChild(body);
        card.appendChild(footer);

        gridEl.appendChild(card);
      });
    }

    async function loadProducts() {
      try {
        setStatus("Loading products from Google Sheets…", false);
        const res = await fetch(PRODUCTS_SHEET_CSV_URL);
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }
        const csvText = await res.text();
        const rows = csvToObjects(csvText);

        // Filter down to active products
        const active = rows.filter(r => (r.active || "").toUpperCase() === "TRUE");
        renderProducts(active);
      } catch (err) {
        console.error(err);
        setStatus("Error loading products. Please try again later.", false);
        gridEl.innerHTML =
          "<p>There was a problem loading products from Google Sheets.</p>";
      }
    }

    loadProducts();
  </script>
</body>
</html>
